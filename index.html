<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏û‡∏∞‡πÄ‡∏¢‡∏≤‡∏£‡∏≤‡∏° - Google Apps Script</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .gradient-orange {
            background: linear-gradient(135deg, #fed7aa, #fb923c);
        }
        .sidebar-gradient {
            background: linear-gradient(180deg, #fb923c, #ea580c);
        }
        .login-gradient {
            background: linear-gradient(135deg, #fb923c, #ea580c);
        }
        .swal2-popup {
            font-family: 'Sarabun', sans-serif !important;
        }
    </style>
</head>
<body class="bg-orange-100 font-sans">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-md w-full space-y-8">
            <div class="text-center">
                <h1 class="text-4xl font-bold text-orange-600 mb-2">üçú</h1>
                <h2 class="text-3xl font-bold text-gray-900">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏û‡∏∞‡πÄ‡∏¢‡∏≤‡∏£‡∏≤‡∏°</h2>
                <p class="mt-2 text-sm text-gray-600">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
            </div>
            <div class="bg-white rounded-lg shadow-lg p-8">
                <form id="loginForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                        <input type="text" id="username" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                        <input type="password" id="password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" required>
                    </div>
                    <button type="submit" class="w-full login-gradient text-white py-3 px-4 rounded-lg hover:opacity-90 transition-opacity font-medium">
                        ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                </form>
                <div class="mt-6 p-4 bg-gray-50 rounded-lg hidden">
                    <h3 class="font-medium text-gray-700 mb-2">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</h3>
                    <div class="text-sm text-gray-600 space-y-1">
                        <p><strong>Admin:</strong> admin / pyr054411111</p>
                        <p><strong>User ‡∏Ç‡∏≤‡∏¢:</strong> user / user123</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="flex h-full min-h-full hidden">
        <!-- Sidebar -->
        <div class="w-64 sidebar-gradient text-white shadow-lg">
            <div class="p-6">
                <h1 class="text-xl font-bold mb-4">üçú ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏û‡∏∞‡πÄ‡∏¢‡∏≤‡∏£‡∏≤‡∏°</h1>
                <div class="mb-6 p-3 bg-orange-600 rounded-lg">
                    <p class="text-sm">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: <span id="currentUser" class="font-medium"></span></p>
                    <p class="text-xs opacity-75">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå: <span id="currentRole" class="font-medium"></span></p>
                </div>
                <nav class="space-y-2" id="navigation">
                    <!-- Navigation will be populated based on user role -->
                </nav>
                <button onclick="logout()" class="w-full mt-6 bg-red-500 hover:bg-red-600 text-white p-3 rounded-lg transition-colors">
                    ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-6">
            <!-- Home Page -->
            <div id="homePage" class="page">
                <div class="gradient-orange rounded-lg p-6 mb-6">
                    <h2 class="text-2xl font-bold text-white mb-4">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏û‡∏∞‡πÄ‡∏¢‡∏≤‡∏£‡∏≤‡∏°</h2>
                    <p class="text-orange-100">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢‡∏î‡∏≤‡∏¢</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white rounded-lg p-6 shadow-md">
                        <h3 class="text-lg font-semibold mb-2 text-gray-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
                        <p class="text-3xl font-bold text-green-600" id="todaySales">‡∏ø0</p>
                    </div>
                    <div class="bg-white rounded-lg p-6 shadow-md">
                        <h3 class="text-lg font-semibold mb-2 text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h3>
                        <p class="text-3xl font-bold text-blue-600" id="memberCount">0</p>
                    </div>
                    <div class="bg-white rounded-lg p-6 shadow-md">
                        <h3 class="text-lg font-semibold mb-2 text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                        <p class="text-3xl font-bold text-yellow-600" id="productCount">0</p>
                    </div>
                </div>

                <div class="bg-white rounded-lg p-6 shadow-md">
                    <h3 class="text-lg font-semibold mb-4 text-gray-700">‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</h3>
                    <div class="space-y-2">
                        <div class="p-3 bg-orange-50 rounded border-l-4 border-orange-400">
                            <p class="text-sm">üéâ ‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡∏°‡πà! ‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏û‡∏∞‡πÄ‡∏¢‡∏≤‡∏£‡∏≤‡∏° ‡∏û‡∏¥‡πÄ‡∏®‡∏© 20 ‡∏ö‡∏≤‡∏ó</p>
                        </div>
                        <div class="p-3 bg-blue-50 rounded border-l-4 border-blue-400">
                            <p class="text-sm">üì¢ ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡∏•‡∏î 10% ‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏ô‡∏π</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg p-6 shadow-md mt-6">
                    <h3 class="text-lg font-semibold mb-4 text-gray-700">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Google Sheets</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button onclick="saveToGoogleSheets()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors flex items-center justify-center space-x-2">
                            <span>üíæ</span>
                            <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Google Sheet</span>
                        </button>
                        <button onclick="loadFromGoogleSheets()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition-colors flex items-center justify-center space-x-2">
                            <span>üìä</span>
                            <span>‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Google Sheet</span>
                        </button>
                    </div>
                    <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                        <p class="text-sm text-gray-600">
                            <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Local Storage ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Å‡∏±‡∏ö Google Sheets ‡πÑ‡∏î‡πâ
                        </p>
                    </div>
                </div>
            </div>

            <!-- Add Product Page (Admin Only) -->
            <div id="addProductPage" class="page hidden">
                <div class="bg-white rounded-lg p-6 shadow-md">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h2>
                    <form id="productForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <input type="text" id="productName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" required>
                        </div>
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <label class="block text-sm font-medium text-gray-700">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏£</label>
                                <button type="button" id="generateDescBtn" onclick="generateDescription()" class="text-sm text-orange-600 hover:text-orange-800 font-medium flex items-center space-x-1 disabled:opacity-50" disabled>
                                    <span>‚ú® ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span>
                                    <svg id="descSpinner" class="animate-spin h-4 w-4 text-orange-600 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                       <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                       <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                </button>
                           </div>
                            <textarea id="productDescription" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" rows="3"></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" id="productPrice" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</label>
                                <input type="number" id="productStock" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" required>
                            </div>
                        </div>
                        <div class="flex space-x-4">
                            <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors flex-1">
                                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                            </button>
                            <button type="button" onclick="saveProductsToGoogleSheets()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition-colors flex items-center space-x-2">
                                <span>üìä</span>
                                <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Google Sheets</span>
                            </button>
                        </div>
                    </form>
                </div>

                <div class="bg-white rounded-lg p-6 shadow-md mt-6">
                    <h3 class="text-lg font-semibold mb-4 text-gray-700">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                    <div id="productList" class="space-y-2"></div>
                </div>
            </div>

            <!-- Payment Page -->
            <div id="paymentPage" class="page hidden">
                <div class="bg-white rounded-lg p-6 shadow-md">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
                    <form id="paymentForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</label>
                            <select id="memberSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</label>
                            <select id="productSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
                            <input type="number" id="quantity" value="1" min="1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                        </div>
                        <button type="button" onclick="addToCart()" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-lg transition-colors">
                            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                        </button>
                    </form>

                    <div class="mt-6">
                        <h3 class="text-lg font-semibold mb-4 text-gray-700">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                        <div id="cart" class="space-y-2 mb-4"></div>
                        <div class="border-t pt-4">
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-lg font-semibold">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°:</span>
                                <span class="text-xl font-bold text-green-600" id="totalAmount">‡∏ø0</span>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</label>
                                <div class="flex items-center space-x-4">
                                    <div class="flex items-center">
                                        <input id="paymentCash" name="paymentMethod" type="radio" value="‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î" class="focus:ring-orange-500 h-4 w-4 text-orange-600 border-gray-300" checked>
                                        <label for="paymentCash" class="ml-2 block text-sm text-gray-900">
                                            ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î
                                        </label>
                                    </div>
                                    <div class="flex items-center">
                                        <input id="paymentTransfer" name="paymentMethod" type="radio" value="‡πÇ‡∏≠‡∏ô" class="focus:ring-orange-500 h-4 w-4 text-orange-600 border-gray-300">
                                        <label for="paymentTransfer" class="ml-2 block text-sm text-gray-900">
                                            ‡πÇ‡∏≠‡∏ô
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢</label>
                                    <input type="number" id="paidAmount" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" oninput="calculateChange()">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏ô</label>
                                    <input type="text" id="changeAmount" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-100" readonly>
                                </div>
                            </div>
                            <button onclick="confirmPayment()" class="w-full bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors mt-4">
                                ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Member Page (Admin Only) -->
            <div id="addMemberPage" class="page hidden">
                <div class="bg-white rounded-lg p-6 shadow-md">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà</h2>
                    <form id="memberForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
                            <input type="text" id="employeeId" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" required>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠</label>
                                <input type="text" id="firstName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                <input type="text" id="lastName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" required>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÅ‡∏ú‡∏ô‡∏Å</label>
                            <input type="text" id="department" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" required>
                        </div>
                        <div class="flex space-x-4">
                            <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors flex-1">
                                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
                            </button>
                            <button type="button" onclick="saveMembersToGoogleSheets()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition-colors flex items-center space-x-2">
                                <span>üìä</span>
                                <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Google Sheets</span>
                            </button>
                        </div>
                    </form>
                </div>

                <div class="bg-white rounded-lg p-6 shadow-md mt-6">
                    <h3 class="text-lg font-semibold mb-4 text-gray-700">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h3>
                    <div id="memberList" class="space-y-2"></div>
                </div>
            </div>

            <!-- Sales Report Page (Admin Only) -->
            <div id="salesReportPage" class="page hidden">
                <div class="bg-white rounded-lg p-6 shadow-md mb-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</h2>
                        <button onclick="saveSalesReportToGoogleSheets()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition-colors flex items-center space-x-2">
                            <span>üìä</span>
                            <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Google Sheets</span>
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                            <h3 class="text-sm font-medium text-green-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
                            <p class="text-2xl font-bold text-green-600" id="reportTodaySales">‡∏ø0</p>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <h3 class="text-sm font-medium text-blue-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</h3>
                            <p class="text-2xl font-bold text-blue-600" id="reportWeeklySales">‡∏ø0</p>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                            <h3 class="text-sm font-medium text-yellow-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h3>
                            <p class="text-2xl font-bold text-yellow-600" id="reportMonthlySales">‡∏ø0</p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                            <h3 class="text-sm font-medium text-purple-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h3>
                            <p class="text-2xl font-bold text-purple-600" id="reportMemberCount">0</p>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg p-6 shadow-md">
                        <h3 class="text-lg font-semibold mb-4 text-gray-700">‡∏Å‡∏£‡∏≤‡∏ü‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</h3>
                        <canvas id="salesChart" width="400" height="200"></canvas>
                    </div>
                    <div class="bg-white rounded-lg p-6 shadow-md">
                        <h3 class="text-lg font-semibold mb-4 text-gray-700">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</h3>
                        <div id="topProducts" class="space-y-2"></div>
                    </div>
                </div>
            </div>

            <!-- Sales History Page (User can see their own sales) -->
            <div id="salesHistoryPage" class="page hidden">
                <div class="bg-white rounded-lg p-6 shadow-md">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h2>
                    <div class="mb-4">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                <h3 class="text-sm font-medium text-green-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô)</h3>
                                <p class="text-2xl font-bold text-green-600" id="mySalesToday">‡∏ø0</p>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                <h3 class="text-sm font-medium text-blue-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)</h3>
                                <p class="text-2xl font-bold text-blue-600" id="myOrdersToday">0</p>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                <h3 class="text-sm font-medium text-yellow-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏° (‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô)</h3>
                                <p class="text-2xl font-bold text-yellow-600" id="myTotalSales">‡∏ø0</p>
                            </div>
                        </div>
                    </div>
                    <div id="mySalesList" class="space-y-2"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let userRole = null;
        let currentCart = [];
        let products = [];
        let members = [];
        let sales = [];
        let salesChartInstance = null; // <-- For Chart.js instance

        // User accounts
        const users = {
            'admin': { password: 'pyr054411111', role: 'admin', name: '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' },
            'user': { password: 'user123', role: 'user', name: '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢' }
        };

        // Google Sheets URLs - **REPLACE WITH YOUR OWN DEPLOYMENT URLS**
        const GOOGLE_SHEETS_SAVE_URL = 'https://script.google.com/macros/s/AKfycbzXKaskLapX_vzRartmVX74x7vnpMhiyVK6Wk2WUbVdnKJQXNL_2unioutQFzMEBfxg/exec';
        const GOOGLE_SHEETS_LOAD_URL = 'https://script.google.com/macros/s/AKfycbzXKaskLapX_vzRartmVX74x7vnpMhiyVK6Wk2WUbVdnKJQXNL_2unioutQFzMEBfxg/exec';
        
        // --- GEMINI API SECTION ---
        const GEMINI_API_KEY = ""; // The Canvas environment will handle this.
        
        /**
         * Fetches data from a URL with a retry mechanism implementing exponential backoff.
         * @param {string} url The URL to fetch.
         * @param {object} options The options for the fetch request.
         * @param {number} maxRetries The maximum number of retries.
         * @returns {Promise<any>} A promise that resolves with the JSON response.
         */
        async function fetchWithRetry(url, options, maxRetries = 3) {
            let attempt = 0;
            while (attempt < maxRetries) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return await response.json();
                } catch (error) {
                    attempt++;
                    if (attempt >= maxRetries) {
                        console.error("Fetch failed after max retries:", error);
                        throw error;
                    }
                    const delay = Math.pow(2, attempt) * 1000; // Exponential backoff
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        /**
         * Generates a food description using the Gemini API.
         */
        async function generateDescription() {
            const productName = document.getElementById('productName').value;
            if (!productName.trim()) {
                showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô', 'warning');
                return;
            }

            const generateBtn = document.getElementById('generateDescBtn');
            const spinner = document.getElementById('descSpinner');
            const descriptionArea = document.getElementById('productDescription');
            
            generateBtn.disabled = true;
            spinner.classList.remove('hidden');
            descriptionArea.value = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ AI ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢...";

            const prompt = `‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á‡∏î‡∏π‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ä‡∏∑‡πà‡∏≠ '${productName}' ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß 1-2 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ`;
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${GEMINI_API_KEY}`;

            const payload = {
                contents: [{ parts: [{ text: prompt }] }]
            };

            try {
                const result = await fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    descriptionArea.value = text.trim();
                } else {
                    throw new Error("No text found in API response.");
                }

            } catch (error) {
                console.error('Error calling Gemini API:', error);
                showAlert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢', 'error');
                descriptionArea.value = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
            } finally {
                generateBtn.disabled = false;
                spinner.classList.add('hidden');
            }
        }
        
        // --- END GEMINI API SECTION ---


        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadFromLocalStorage();
            checkLogin();
            // Add event listener to enable/disable generate button
            document.getElementById('productName').addEventListener('input', (e) => {
                document.getElementById('generateDescBtn').disabled = !e.target.value.trim();
            });
        });

        // Local Storage functions
        function saveToLocalStorage() {
            const data = {
                products: products,
                members: members,
                sales: sales,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('restaurantData', JSON.stringify(data));
        }

        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('restaurantData');
            if (savedData) {
                const data = JSON.parse(savedData);
                products = data.products || [];
                members = data.members || [];
                sales = data.sales || [];
            } else {
                // Initialize with empty arrays if no data exists
                products = [];
                members = [];
                sales = [];
            }
        }

        // Google Sheets integration functions
        function saveProductsToGoogleSheets() {
            if (userRole !== 'admin') {
                showAlert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
                return;
            }

            if (products.length === 0) {
                showAlert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'warning');
                return;
            }

            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...',
                text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            const data = {
                type: 'products',
                products: products,
                timestamp: new Date().toISOString(),
                savedBy: currentUser
            };

            // Create JSONP callback
            const callbackName = 'jsonpCallback_' + Date.now();
            window[callbackName] = function(response) {
                // Clean up
                document.head.removeChild(script);
                delete window[callbackName];

                if (response.success) {
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        text: `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${products.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`,
                        timer: 3000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                        text: response.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ'
                    });
                }
            };

            // Create script tag for JSONP
            const script = document.createElement('script');
            const params = new URLSearchParams({
                action: 'saveProducts',
                data: JSON.stringify(data),
                callback: callbackName
            });
            script.src = `${GOOGLE_SHEETS_SAVE_URL}?${params.toString()}`;
            
            // Handle errors
            script.onerror = function() {
                document.head.removeChild(script);
                delete window[callbackName];
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÑ‡∏î‡πâ'
                });
            };

            document.head.appendChild(script);
        }

        function saveMembersToGoogleSheets() {
            if (userRole !== 'admin') {
                showAlert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
                return;
            }

            if (members.length === 0) {
                showAlert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'warning');
                return;
            }

            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å...',
                text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            const data = {
                type: 'members',
                members: members,
                timestamp: new Date().toISOString(),
                savedBy: currentUser
            };

            // Create JSONP callback
            const callbackName = 'jsonpCallback_' + Date.now();
            window[callbackName] = function(response) {
                // Clean up
                document.head.removeChild(script);
                delete window[callbackName];

                if (response.success) {
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        text: `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ${members.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`,
                        timer: 3000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                        text: response.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏î‡πâ'
                    });
                }
            };

            // Create script tag for JSONP
            const script = document.createElement('script');
            const params = new URLSearchParams({
                action: 'saveMembers',
                data: JSON.stringify(data),
                callback: callbackName
            });
            script.src = `${GOOGLE_SHEETS_SAVE_URL}?${params.toString()}`;
            
            // Handle errors
            script.onerror = function() {
                document.head.removeChild(script);
                delete window[callbackName];
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÑ‡∏î‡πâ'
                });
            };

            document.head.appendChild(script);
        }

        function saveSalesReportToGoogleSheets() {
            if (userRole !== 'admin') {
                showAlert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô', 'error');
                return;
            }

            if (sales.length === 0) {
                showAlert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'warning');
                return;
            }

            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢...',
                text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            // Prepare sales report data
            const today = new Date();
            const todayStr = today.toDateString();
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
            
            const todaySales = sales.filter(sale => new Date(sale.date).toDateString() === todayStr);
            const weeklySales = sales.filter(sale => new Date(sale.date) >= weekAgo);
            const monthlySales = sales.filter(sale => new Date(sale.date) >= monthAgo);
            
            const todayTotal = todaySales.reduce((sum, sale) => sum + sale.total, 0);
            const weeklyTotal = weeklySales.reduce((sum, sale) => sum + sale.total, 0);
            const monthlyTotal = monthlySales.reduce((sum, sale) => sum + sale.total, 0);

            // Calculate top products
            const productSales = {};
            sales.forEach(sale => {
                sale.items.forEach(item => {
                    if (productSales[item.name]) {
                        productSales[item.name] += item.quantity;
                    } else {
                        productSales[item.name] = item.quantity;
                    }
                });
            });
            
            const topProducts = Object.entries(productSales)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10)
                .map(([name, quantity]) => ({ name, quantity }));

            const reportData = {
                type: 'salesReport',
                summary: {
                    todayTotal: todayTotal,
                    weeklyTotal: weeklyTotal,
                    monthlyTotal: monthlyTotal,
                    totalOrders: sales.length,
                    todayOrders: todaySales.length,
                    memberCount: members.length
                },
                topProducts: topProducts,
                allSales: sales,
                timestamp: new Date().toISOString(),
                generatedBy: currentUser
            };

            // Create JSONP callback
            const callbackName = 'jsonpCallback_' + Date.now();
            window[callbackName] = function(response) {
                // Clean up
                document.head.removeChild(script);
                delete window[callbackName];

                if (response.success) {
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        text: `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ ${sales.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`,
                        timer: 3000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                        text: response.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ'
                    });
                }
            };

            // Create script tag for JSONP
            const script = document.createElement('script');
            const params = new URLSearchParams({
                action: 'saveSalesReport',
                data: JSON.stringify(reportData),
                callback: callbackName
            });
            script.src = `${GOOGLE_SHEETS_SAVE_URL}?${params.toString()}`;
            
            // Handle errors
            script.onerror = function() {
                document.head.removeChild(script);
                delete window[callbackName];
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÑ‡∏î‡πâ'
                });
            };

            document.head.appendChild(script);
        }

        function saveToGoogleSheets() {
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
                text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            const data = {
                products: products,
                members: members,
                sales: sales,
                timestamp: new Date().toISOString(),
                savedBy: currentUser
            };

            // Create JSONP callback
            const callbackName = 'jsonpCallback_' + Date.now();
            window[callbackName] = function(response) {
                // Clean up
                document.head.removeChild(script);
                delete window[callbackName];

                if (response.success) {
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                        text: response.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ'
                    });
                }
            };

            // Create script tag for JSONP
            const script = document.createElement('script');
            const params = new URLSearchParams({
                action: 'save',
                data: JSON.stringify(data),
                callback: callbackName
            });
            script.src = `${GOOGLE_SHEETS_SAVE_URL}?${params.toString()}`;
            
            // Handle errors
            script.onerror = function() {
                document.head.removeChild(script);
                delete window[callbackName];
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÑ‡∏î‡πâ'
                });
            };

            document.head.appendChild(script);
        }

        function loadFromGoogleSheets() {
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
                text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            // Create JSONP callback
            const callbackName = 'jsonpCallback_' + Date.now();
            window[callbackName] = function(response) {
                // Clean up
                document.head.removeChild(script);
                delete window[callbackName];

                if (response.success && response.data) {
                    // Update local data
                    products = response.data.products || [];
                    members = response.data.members || [];
                    sales = response.data.sales || [];
                    
                    // Save to local storage
                    saveToLocalStorage();
                    
                    // Update UI
                    refreshUI();

                    Swal.fire({
                        icon: 'success',
                        title: '‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets ‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                        text: response.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ'
                    });
                }
            };

            // Create script tag for JSONP
            const script = document.createElement('script');
            const params = new URLSearchParams({
                action: 'load',
                callback: callbackName
            });
            script.src = `${GOOGLE_SHEETS_LOAD_URL}?${params.toString()}`;
            
            // Handle errors
            script.onerror = function() {
                document.head.removeChild(script);
                delete window[callbackName];
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÑ‡∏î‡πâ'
                });
            };

            document.head.appendChild(script);
        }

        // Authentication
        function checkLogin() {
            showLoginPage();
        }

        function showLoginPage() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        function showMainApp() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            document.getElementById('currentUser').textContent = users[currentUser]?.name || currentUser;
            document.getElementById('currentRole').textContent = userRole === 'admin' ? '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' : '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢';
            
            setupNavigation();
            showPage('home');
            refreshUI();
        }

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (users[username] && users[username].password === password) {
                currentUser = username;
                userRole = users[username].role;
                
                showAlert(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${users[username].name}`, 'success');
                setTimeout(() => {
                    showMainApp();
                }, 1000);
            } else {
                showAlert('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
            }
        });

        function logout() {
            Swal.fire({
                title: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö',
                text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    // Clear user data
                    currentUser = null;
                    userRole = null;
                    currentCart = [];
                    
                    // Show success message
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                        text: '‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£',
                        timer: 1500,
                        showConfirmButton: false
                    }).then(() => {
                        // Reset and show login page
                        showLoginPage();
                        document.getElementById('loginForm').reset();
                        
                        // Clear any displayed data
                        document.getElementById('cart').innerHTML = '';
                        document.getElementById('totalAmount').textContent = '‡∏ø0';
                        document.getElementById('paidAmount').value = '';
                        document.getElementById('changeAmount').value = '';
                    });
                }
            });
        }

        // Navigation setup based on user role
        function setupNavigation() {
            const navigation = document.getElementById('navigation');
            navigation.innerHTML = '';
            
            const commonPages = [
                { id: 'home', icon: 'üè†', name: '‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å' },
                { id: 'payment', icon: 'üí∏', name: '‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô' }
            ];
            
            const adminPages = [
                { id: 'addProduct', icon: 'üîº', name: '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤' },
                { id: 'addMember', icon: '‚ûï', name: '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å' },
                { id: 'salesReport', icon: 'üìä', name: '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢' }
            ];
            
            const userPages = [
                { id: 'salesHistory', icon: 'üìã', name: '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢' }
            ];
            
            let pages = [...commonPages];
            
            if (userRole === 'admin') {
                pages = [...pages, ...adminPages];
            } else {
                pages = [...pages, ...userPages];
            }
            
            pages.forEach(page => {
                const button = document.createElement('button');
                button.onclick = () => showPage(page.id);
                button.className = 'w-full text-left p-3 rounded-lg hover:bg-orange-600 transition-colors flex items-center space-x-2';
                button.innerHTML = `<span>${page.icon}</span><span>${page.name}</span>`;
                navigation.appendChild(button);
            });
        }

        // Page navigation
        function showPage(pageId) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.add('hidden'));
            document.getElementById(pageId + 'Page').classList.remove('hidden');
            
            if (pageId === 'salesHistory') {
                updateMySalesHistory();
            }
             if (pageId === 'salesReport') {
                updateSalesReport();
            }
        }

        // Product management
        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (userRole !== 'admin') {
                showAlert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', 'error');
                return;
            }
            
            const product = {
                name: document.getElementById('productName').value,
                description: document.getElementById('productDescription').value,
                price: parseFloat(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                createdAt: new Date().toISOString(),
                createdBy: currentUser
            };
            
            products.push(product);
            saveToLocalStorage();
            
            Swal.fire({
                icon: 'success',
                title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                text: '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                timer: 1500,
                showConfirmButton: false
            });
            
            document.getElementById('productForm').reset();
            refreshUI();
        });

        function displayProducts() {
            const productList = document.getElementById('productList');
            productList.innerHTML = '';
            
            products.forEach((product, index) => {
                const div = document.createElement('div');
                div.className = 'p-3 bg-gray-50 rounded border flex justify-between items-center';
                div.innerHTML = `
                    <div>
                        <h4 class="font-medium">${product.name}</h4>
                        <p class="text-sm text-gray-600">${product.description}</p>
                        <p class="text-sm">‡∏£‡∏≤‡∏Ñ‡∏≤: ‡∏ø${product.price} | ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${product.stock}</p>
                    </div>
                    <div class="flex space-x-2">
                        ${userRole === 'admin' ? `
                            <button onclick="editProduct(${index})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                                ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            </button>
                            <button onclick="deleteProduct(${index})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                                ‡∏•‡∏ö
                            </button>
                        ` : ''}
                    </div>
                `;
                productList.appendChild(div);
            });
        }
        
        function editProduct(index) {
            if (userRole !== 'admin') {
                showAlert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', 'error');
                return;
            }
            const product = products[index];

            Swal.fire({
                title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',
                html: `
                    <div class="space-y-4 text-left">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <input id="swal-productName" class="swal2-input w-full" value="${product.name}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</label>
                            <textarea id="swal-productDescription" class="swal2-textarea w-full">${product.description}</textarea>
                        </div>
                         <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤</label>
                                <input id="swal-productPrice" type="number" class="swal2-input w-full" value="${product.price}">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</label>
                                <input id="swal-productStock" type="number" class="swal2-input w-full" value="${product.stock}">
                            </div>
                        </div>
                    </div>
                `,
                focusConfirm: false,
                showCancelButton: true,
                confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                preConfirm: () => {
                    const name = document.getElementById('swal-productName').value;
                    const description = document.getElementById('swal-productDescription').value;
                    const price = parseFloat(document.getElementById('swal-productPrice').value);
                    const stock = parseInt(document.getElementById('swal-productStock').value);

                    if (!name || isNaN(price) || isNaN(stock)) {
                        Swal.showValidationMessage(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`);
                        return false;
                    }
                    return { name, description, price, stock };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    products[index] = {
                        ...products[index],
                        name: result.value.name,
                        description: result.value.description,
                        price: result.value.price,
                        stock: result.value.stock
                    };
                    saveToLocalStorage();
                    refreshUI();
                    Swal.fire('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß!', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß', 'success');
                }
            });
        }


        function deleteProduct(index) {
            if (userRole !== 'admin') {
                showAlert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', 'error');
                return;
            }
            
            Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            }).then((result) => {
                if (result.isConfirmed) {
                    products.splice(index, 1);
                    saveToLocalStorage();
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        text: '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                        timer: 1500,
                        showConfirmButton: false
                    });
                    
                    refreshUI();
                }
            });
        }

        // Member management
        document.getElementById('memberForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (userRole !== 'admin') {
                showAlert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å', 'error');
                return;
            }
            
            const member = {
                employeeId: document.getElementById('employeeId').value,
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                department: document.getElementById('department').value,
                createdAt: new Date().toISOString(),
                createdBy: currentUser
            };
            
            members.push(member);
            saveToLocalStorage();
            
            Swal.fire({
                icon: 'success',
                title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                text: '‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                timer: 1500,
                showConfirmButton: false
            });
            
            document.getElementById('memberForm').reset();
            refreshUI();
        });

        function displayMembers() {
            const memberList = document.getElementById('memberList');
            memberList.innerHTML = '';
            
            members.forEach((member, index) => {
                const div = document.createElement('div');
                div.className = 'p-3 bg-gray-50 rounded border flex justify-between items-center';
                div.innerHTML = `
                    <div>
                        <h4 class="font-medium">${member.firstName} ${member.lastName}</h4>
                        <p class="text-sm text-gray-600">‡∏£‡∏´‡∏±‡∏™: ${member.employeeId} | ‡πÅ‡∏ú‡∏ô‡∏Å: ${member.department}</p>
                    </div>
                    <div class="flex space-x-2">
                        ${userRole === 'admin' ? `
                            <button onclick="editMember(${index})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                                ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            </button>
                            <button onclick="deleteMember(${index})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                                ‡∏•‡∏ö
                            </button>
                        ` : ''}
                    </div>
                `;
                memberList.appendChild(div);
            });
        }
        
        function editMember(index) {
             if (userRole !== 'admin') {
                showAlert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å', 'error');
                return;
            }
            const member = members[index];

            Swal.fire({
                title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å',
                html: `
                    <div class="space-y-4 text-left">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
                            <input id="swal-employeeId" class="swal2-input w-full" value="${member.employeeId}">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                           <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠</label>
                                <input id="swal-firstName" class="swal2-input w-full" value="${member.firstName}">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                <input id="swal-lastName" class="swal2-input w-full" value="${member.lastName}">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡πÅ‡∏ú‡∏ô‡∏Å</label>
                            <input id="swal-department" class="swal2-input w-full" value="${member.department}">
                        </div>
                    </div>
                `,
                focusConfirm: false,
                showCancelButton: true,
                confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                preConfirm: () => {
                    const employeeId = document.getElementById('swal-employeeId').value;
                    const firstName = document.getElementById('swal-firstName').value;
                    const lastName = document.getElementById('swal-lastName').value;
                    const department = document.getElementById('swal-department').value;

                    if (!employeeId || !firstName || !lastName || !department) {
                        Swal.showValidationMessage(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô`);
                        return false;
                    }
                    return { employeeId, firstName, lastName, department };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                     members[index] = {
                        ...members[index],
                        employeeId: result.value.employeeId,
                        firstName: result.value.firstName,
                        lastName: result.value.lastName,
                        department: result.value.department
                    };
                    saveToLocalStorage();
                    refreshUI();
                    Swal.fire('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß!', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß', 'success');
                }
            });
        }


        function deleteMember(index) {
            if (userRole !== 'admin') {
                showAlert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å', 'error');
                return;
            }
            
            Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            }).then((result) => {
                if (result.isConfirmed) {
                    members.splice(index, 1);
                    saveToLocalStorage();
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        text: '‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                        timer: 1500,
                        showConfirmButton: false
                    });
                    
                    refreshUI();
                }
            });
        }

        // Payment system
        function loadProductOptions() {
            const select = document.getElementById('productSelect');
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>';
            
            products.forEach((product, index) => {
                if (product.stock > 0) {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${product.name} - ‡∏ø${product.price}`;
                    select.appendChild(option);
                }
            });
        }

        function loadMemberOptions() {
            const select = document.getElementById('memberSelect');
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</option>';
            
            members.forEach((member, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${member.firstName} ${member.lastName} (${member.employeeId})`;
                select.appendChild(option);
            });
        }

        function addToCart() {
            const productIndex = parseInt(document.getElementById('productSelect').value);
            const quantity = parseInt(document.getElementById('quantity').value);
            
            if (isNaN(productIndex) || !quantity) {
                showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô', 'warning');
                return;
            }
            
            const product = products[productIndex];
            if (product.stock < quantity) {
                showAlert(`‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏û‡∏µ‡∏¢‡∏á ${product.stock} ‡∏ä‡∏¥‡πâ‡∏ô`, 'error');
                return;
            }
            
            const existingItem = currentCart.find(item => item.productIndex === productIndex);
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                currentCart.push({
                    productIndex: productIndex,
                    name: product.name,
                    price: product.price,
                    quantity: quantity
                });
            }
            
            displayCart();
            document.getElementById('quantity').value = 1;
        }

        function displayCart() {
            const cart = document.getElementById('cart');
            cart.innerHTML = '';
            let total = 0;
            
            currentCart.forEach((item, index) => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const div = document.createElement('div');
                div.className = 'p-3 bg-gray-50 rounded border flex justify-between items-center';
                div.innerHTML = `
                    <div>
                        <h4 class="font-medium">${item.name}</h4>
                        <p class="text-sm text-gray-600">‡∏ø${item.price} x ${item.quantity} = ‡∏ø${itemTotal}</p>
                    </div>
                    <button onclick="removeFromCart(${index})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                        ‡∏•‡∏ö
                    </button>
                `;
                cart.appendChild(div);
            });
            
            document.getElementById('totalAmount').textContent = `‡∏ø${total}`;
            calculateChange();
        }

        function removeFromCart(index) {
            currentCart.splice(index, 1);
            displayCart();
        }

        function calculateChange() {
            const total = currentCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const paid = parseFloat(document.getElementById('paidAmount').value) || 0;
            const change = paid - total;
            
            document.getElementById('changeAmount').value = change >= 0 ? `‡∏ø${change}` : '‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠';
        }

        function confirmPayment() {
            if (currentCart.length === 0) {
                showAlert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤', 'warning');
                return;
            }
            
            const total = currentCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const paid = parseFloat(document.getElementById('paidAmount').value) || 0;
            
            if (paid < total) {
                showAlert('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠', 'error');
                return;
            }
            
            const memberIndex = document.getElementById('memberSelect').value;
            const member = memberIndex !== '' ? members[parseInt(memberIndex)] : null;
            const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
            
            const sale = {
                memberId: memberIndex,
                memberName: member ? `${member.firstName} ${member.lastName}` : '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ',
                items: [...currentCart],
                total: total,
                paid: paid,
                change: paid - total,
                paymentMethod: paymentMethod,
                date: new Date().toISOString(),
                soldBy: currentUser
            };
            
            // Update product stock
            sale.items.forEach(item => {
                products[item.productIndex].stock -= item.quantity;
            });
            
            // Add sale record
            sales.push(sale);
            saveToLocalStorage();
            
            Swal.fire({
                icon: 'success',
                title: '‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                text: `‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏ô: ‡∏ø${paid - total}`,
                timer: 2000,
                showConfirmButton: false
            });
            
            // Reset form
            currentCart = [];
            displayCart();
            document.getElementById('memberSelect').value = '';
            document.getElementById('productSelect').value = '';
            document.getElementById('paidAmount').value = '';
            document.getElementById('changeAmount').value = '';
            
            refreshUI();
        }

        // --- NEW --- Central function to refresh all UI components
        function refreshUI() {
            displayProducts();
            displayMembers();
            loadProductOptions();
            loadMemberOptions();
            updateDashboard();
            updateSalesReport();
            updateMySalesHistory();
        }

        // Dashboard updates
        function updateDashboard() {
            const today = new Date().toDateString();
            const todaySales = sales.filter(sale => new Date(sale.date).toDateString() === today);
            const todayTotal = todaySales.reduce((sum, sale) => sum + sale.total, 0);
            
            document.getElementById('todaySales').textContent = `‡∏ø${todayTotal}`;
            document.getElementById('memberCount').textContent = members.length;
            document.getElementById('productCount').textContent = products.length;
        }

        // Sales report (Admin only)
        function updateSalesReport() {
            if (userRole !== 'admin') return;
            
            const today = new Date();
            const todayStr = today.toDateString();
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
            
            const todaySales = sales.filter(sale => new Date(sale.date).toDateString() === todayStr);
            const weeklySales = sales.filter(sale => new Date(sale.date) >= weekAgo);
            const monthlySales = sales.filter(sale => new Date(sale.date) >= monthAgo);
            
            const todayTotal = todaySales.reduce((sum, sale) => sum + sale.total, 0);
            const weeklyTotal = weeklySales.reduce((sum, sale) => sum + sale.total, 0);
            const monthlyTotal = monthlySales.reduce((sum, sale) => sum + sale.total, 0);
            
            document.getElementById('reportTodaySales').textContent = `‡∏ø${todayTotal}`;
            document.getElementById('reportWeeklySales').textContent = `‡∏ø${weeklyTotal}`;
            document.getElementById('reportMonthlySales').textContent = `‡∏ø${monthlyTotal}`;
            document.getElementById('reportMemberCount').textContent = members.length;
            
            updateSalesChart();
            updateTopProducts();
        }

        function updateSalesChart() {
            if (userRole !== 'admin') return;
            
            const ctx = document.getElementById('salesChart').getContext('2d');
            
            if (salesChartInstance) {
                salesChartInstance.destroy();
            }

            // Get last 7 days data
            const last7Days = [];
            const salesData = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();
                
                last7Days.push(date.toLocaleDateString('th-TH', { weekday: 'short' }));
                
                const daySales = sales.filter(sale => new Date(sale.date).toDateString() === dateStr);
                const dayTotal = daySales.reduce((sum, sale) => sum + sale.total, 0);
                salesData.push(dayTotal);
            }
            
            salesChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: last7Days,
                    datasets: [{
                        label: '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)',
                        data: salesData,
                        backgroundColor: 'rgba(251, 146, 60, 0.8)',
                        borderColor: 'rgba(251, 146, 60, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateTopProducts() {
            if (userRole !== 'admin') return;
            
            const productSales = {};
            
            sales.forEach(sale => {
                sale.items.forEach(item => {
                    if (productSales[item.name]) {
                        productSales[item.name] += item.quantity;
                    } else {
                        productSales[item.name] = item.quantity;
                    }
                });
            });
            
            const sortedProducts = Object.entries(productSales)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);
            
            const topProducts = document.getElementById('topProducts');
            topProducts.innerHTML = '';
            
            sortedProducts.forEach(([name, quantity], index) => {
                const div = document.createElement('div');
                div.className = 'p-3 bg-gray-50 rounded border flex justify-between items-center';
                div.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <span class="bg-orange-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">
                            ${index + 1}
                        </span>
                        <span class="font-medium">${name}</span>
                    </div>
                    <span class="text-gray-600">${quantity} ‡∏ä‡∏¥‡πâ‡∏ô</span>
                `;
                topProducts.appendChild(div);
            });
        }

        // My sales history (User can see their own sales)
        function updateMySalesHistory() {
            if (userRole === 'admin') return;
            
            const mySales = sales.filter(sale => sale.soldBy === currentUser);
            const today = new Date().toDateString();
            const todayMySales = mySales.filter(sale => new Date(sale.date).toDateString() === today);
            
            const todayTotal = todayMySales.reduce((sum, sale) => sum + sale.total, 0);
            const totalSales = mySales.reduce((sum, sale) => sum + sale.total, 0);
            
            document.getElementById('mySalesToday').textContent = `‡∏ø${todayTotal}`;
            document.getElementById('myOrdersToday').textContent = todayMySales.length;
            document.getElementById('myTotalSales').textContent = `‡∏ø${totalSales}`;
            
            const mySalesList = document.getElementById('mySalesList');
            mySalesList.innerHTML = '';
            
            const recentSales = mySales.slice(-10).reverse();
            
            recentSales.forEach(sale => {
                const div = document.createElement('div');
                div.className = 'p-4 bg-gray-50 rounded border';
                
                const saleDate = new Date(sale.date);
                const itemsList = sale.items.map(item => `${item.name} x${item.quantity}`).join(', ');
                
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h4 class="font-medium">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${sale.memberName}</h4>
                            <p class="text-sm text-gray-600">${itemsList}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-green-600">‡∏ø${sale.total}</p>
                            <p class="text-xs text-gray-500">${saleDate.toLocaleString('th-TH')}</p>
                        </div>
                    </div>
                `;
                mySalesList.appendChild(div);
            });
            
            if (recentSales.length === 0) {
                mySalesList.innerHTML = '<p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</p>';
            }
        }

        // Utility functions
        function showAlert(message, type = 'info') {
            const iconMap = {
                'success': 'success',
                'error': 'error',
                'warning': 'warning',
                'info': 'info'
            };
            
            Swal.fire({
                icon: iconMap[type] || 'info',
                title: message,
                timer: 2000,
                showConfirmButton: false,
                toast: true,
                position: 'top-end'
            });
        }

    </script>
</body>
</html>


