 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/index.html b/index.html
index 87e94b6724be9e0a53b40cbc749246dca674920e..73240dfda982253909a84c3d65fd1c8e66573707 100644
--- a/index.html
+++ b/index.html
@@ -359,50 +359,100 @@
         <!-- Sidebar Overlay for Mobile -->
         <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden"></div>
     </div>
 
     <script>
         // Global variables
         let currentUser = null;
         let userRole = null;
         let currentCart = [];
         let products = [];
         let members = [];
         let sales = [];
         let announcements = {
             promo1: "üéâ ‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡∏°‡πà! ‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏û‡∏∞‡πÄ‡∏¢‡∏≤‡∏£‡∏≤‡∏° ‡∏û‡∏¥‡πÄ‡∏®‡∏© 45 ‡∏ö‡∏≤‡∏ó",
             promo2: "üì¢ ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡∏•‡∏î 10% ‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏ô‡∏π"
         };
         let salesChartInstance = null;
         
         const users = {
             'admin': { password: 'pyr054411111', role: 'admin', name: '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' },
             'user': { password: 'user123', role: 'user', name: '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢' }
         };
 
         const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbzXKaskLapX_vzRartmVX74x7vnpMhiyVK6Wk2WUbVdnKJQXNL_2unioutQFzMEBfxg/exec';
         const GEMINI_API_KEY = '';
+
+        function callGoogleAppsScript(action, payload = null, { timeout = 15000 } = {}) {
+            return new Promise((resolve, reject) => {
+                if (!GOOGLE_SHEETS_URL) {
+                    reject(new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö URL ‡∏Ç‡∏≠‡∏á Google Apps Script'));
+                    return;
+                }
+
+                const callbackName = `jsonpCallback_${action}_${Date.now()}_${Math.floor(Math.random() * 1000)}`;
+                const params = new URLSearchParams({ action, callback: callbackName });
+                if (payload !== null && payload !== undefined) {
+                    params.set('data', JSON.stringify(payload));
+                }
+
+                const script = document.createElement('script');
+                let timeoutId = null;
+
+                const cleanup = () => {
+                    if (timeoutId) {
+                        clearTimeout(timeoutId);
+                    }
+                    if (script.parentNode) {
+                        script.parentNode.removeChild(script);
+                    }
+                    try {
+                        delete window[callbackName];
+                    } catch (err) {
+                        window[callbackName] = undefined;
+                    }
+                };
+
+                window[callbackName] = (response) => {
+                    cleanup();
+                    resolve(response);
+                };
+
+                script.src = `${GOOGLE_SHEETS_URL}?${params.toString()}`;
+                script.onerror = () => {
+                    cleanup();
+                    reject(new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Apps Script ‡πÑ‡∏î‡πâ'));
+                };
+
+                timeoutId = setTimeout(() => {
+                    cleanup();
+                    reject(new Error('‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å Google Apps Script'));
+                }, timeout);
+
+                document.head.appendChild(script);
+            });
+        }
         
         async function fetchWithRetry(url, options, maxRetries = 3) {
             for (let attempt = 0; attempt < maxRetries; attempt++) {
                 try {
                     const response = await fetch(url, options);
                     if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                     return await response.json();
                 } catch (error) {
                     if (attempt === maxRetries - 1) throw error;
                     await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempt) * 1000));
                 }
             }
         }
 
         async function generateDescription() {
             const productName = document.getElementById('productName').value;
             if (!productName.trim()) { showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô', 'warning'); return; }
             const generateBtn = document.getElementById('generateDescBtn');
             const spinner = document.getElementById('descSpinner');
             const descriptionArea = document.getElementById('productDescription');
             generateBtn.disabled = true;
             spinner.classList.remove('hidden');
             descriptionArea.value = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ AI ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢...";
             const prompt = `‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á‡∏î‡∏π‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ä‡∏∑‡πà‡∏≠ '${productName}' ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß 1-2 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ`;
             const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${GEMINI_API_KEY}`;
@@ -468,123 +518,106 @@
                 const navButtons = document.querySelectorAll('#navigation button, #desktopSidebarToggler');
                 if (state === 'collapsed') {
                     sidebar.classList.replace('w-64', 'w-20');
                     mainContent.classList.replace('md:ml-64', 'md:ml-20');
                     navTexts.forEach(text => text.classList.add('hidden'));
                     navButtons.forEach(btn => btn.classList.add('justify-center'));
                     desktopTogglerIcon.classList.add('rotate-180');
                 } else {
                     sidebar.classList.replace('w-20', 'w-64');
                     mainContent.classList.replace('md:ml-20', 'md:ml-64');
                     navTexts.forEach(text => text.classList.remove('hidden'));
                     navButtons.forEach(btn => btn.classList.remove('justify-center'));
                     desktopTogglerIcon.classList.remove('rotate-180');
                 }
             };
             mobileHamburgerBtn.addEventListener('click', openMobileSidebar);
             sidebarOverlay.addEventListener('click', closeMobileSidebar);
             desktopSidebarToggler.addEventListener('click', toggleDesktopSidebar);
             window.closeMobileSidebar = closeMobileSidebar;
             window.applyDesktopSidebarState = applyDesktopSidebarState;
         }
 
         // --- DATA SYNCING ---
         function syncDataToGoogleSheets() {
             const data = { products, members, sales, announcements, timestamp: new Date().toISOString(), savedBy: currentUser };
-            const callbackName = 'jsonpCallback_sync_' + Date.now();
-            window[callbackName] = function(response) {
-                if (document.head.contains(script)) {
-                    document.head.removeChild(script);
-                }
-                delete window[callbackName];
-                if (!response.success) {
-                    console.error("Auto-sync failed:", response.error);
-                    showAlert('‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
-                }
-            };
-            const script = document.createElement('script');
-            const params = new URLSearchParams({ action: 'save', data: JSON.stringify(data), callback: callbackName });
-            
-            const fullUrl = `${GOOGLE_SHEETS_URL}?${params.toString()}`;
-            console.log("Attempting to sync with URL:", fullUrl); // This will show the exact URL being called in the F12 Console
-            
-            script.src = fullUrl;
-            script.onerror = () => {
-                 if (document.head.contains(script)) {
-                    document.head.removeChild(script);
-                }
-                delete window[callbackName];
-                console.error("Auto-sync failed: Network error");
-                showAlert('‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß! ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Deploy ‡πÅ‡∏•‡∏∞ URL', 'error');
-            };
-            document.head.appendChild(script);
+            callGoogleAppsScript('save', data)
+                .then((response) => {
+                    if (!response?.success) {
+                        console.error('Auto-sync failed:', response?.error);
+                        showAlert('‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
+                    }
+                })
+                .catch((error) => {
+                    console.error('Auto-sync failed:', error);
+                    showAlert('‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß! ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Deploy ‡πÅ‡∏•‡∏∞ URL', 'error');
+                });
         }
 
         function loadFromGoogleSheets(isManualRefresh = false) {
+            const showLoading = () => Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà', allowOutsideClick: false, didOpen: () => { Swal.showLoading(); } });
+            const hideLoading = () => { if (Swal.isLoading()) Swal.close(); };
+
             if (isManualRefresh) {
-                Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà', allowOutsideClick: false, didOpen: () => { Swal.showLoading(); } });
+                showLoading();
             }
-            const callbackName = 'jsonpCallback_load_' + Date.now();
-            window[callbackName] = function(response) {
-                if (document.head.contains(script)) {
-                    document.head.removeChild(script);
-                }
-                delete window[callbackName];
-                if (response.success && response.data) {
-                    products = response.data.products || [];
-                    members = response.data.members || [];
-                    sales = response.data.sales || [];
-                    if (response.data.announcements) {
-                        announcements = response.data.announcements;
+
+            callGoogleAppsScript('load')
+                .then((response) => {
+                    if (response?.success && response?.data) {
+                        products = response.data.products || [];
+                        members = response.data.members || [];
+                        sales = response.data.sales || [];
+                        if (response.data.announcements) {
+                            announcements = response.data.announcements;
+                        }
+                        refreshUI();
+                        if (isManualRefresh) {
+                            Swal.fire({ icon: 'success', title: '‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', timer: 1500, showConfirmButton: false });
+                        }
+                    } else {
+                        const errorMessage = response?.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ';
+                        if (isManualRefresh) {
+                            Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', text: errorMessage });
+                        } else {
+                            showAlert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏î‡πâ', 'error');
+                        }
                     }
-                    refreshUI();
+                })
+                .catch((error) => {
+                    console.error('Load data failed:', error);
                     if (isManualRefresh) {
-                        Swal.fire({ icon: 'success', title: '‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', timer: 1500, showConfirmButton: false });
+                        Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÑ‡∏î‡πâ' });
+                    } else {
+                        showAlert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ', 'error');
                     }
-                } else {
+                })
+                .finally(() => {
                     if (isManualRefresh) {
-                        Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', text: response.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ' });
-                    } else {
-                        showAlert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏î‡πâ', 'error');
+                        hideLoading();
                     }
-                }
-            };
-            const script = document.createElement('script');
-            const params = new URLSearchParams({ action: 'load', callback: callbackName });
-            script.src = `${GOOGLE_SHEETS_URL}?${params.toString()}`;
-            script.onerror = function() {
-                if (document.head.contains(script)) {
-                    document.head.removeChild(script);
-                }
-                delete window[callbackName];
-                 if (isManualRefresh) {
-                    Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÑ‡∏î‡πâ' });
-                } else {
-                    showAlert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ', 'error');
-                }
-            };
-            document.head.appendChild(script);
+                });
         }
 
         // --- AUTH & UI FLOW ---
         function checkLogin() { showLoginPage(); }
         function showLoginPage() { document.getElementById('loginPage').classList.remove('hidden'); document.getElementById('mainApp').classList.add('hidden'); }
 
         function showMainApp() {
             document.getElementById('loginPage').classList.add('hidden');
             document.getElementById('mainApp').classList.remove('hidden');
             document.getElementById('currentUser').textContent = users[currentUser]?.name || currentUser;
             document.getElementById('currentRole').textContent = userRole === 'admin' ? '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' : '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢';
             
             // Role-specific UI adjustments
             const memberSelectContainer = document.getElementById('memberSelectContainer');
             if (memberSelectContainer) {
                 if (userRole === 'user') {
                     memberSelectContainer.classList.add('hidden');
                 } else {
                     memberSelectContainer.classList.remove('hidden');
                 }
             }
 
             setupNavigation();
             showPage('home'); 
EOF
)
